#!/bin/bash

# Функция для вывода подсказки
show_help() {
    echo "Использование: $0 <адрес_подсети>"
    echo "Пример: $0 192.168.1."
    echo "Проверяет доступность всех узлов в подсети и записывает ответившие узлы в файл."
}

# Проверка на количество аргументов
if [[ "$#" -ne 1 ]]; then
    echo "Ошибка: Неправильное количество аргументов."
    show_help
    exit 1
fi

# Проверка на --help опцию
if [[ "$1" == "--help" ]]; then
    show_help
    exit 0
fi

# Аргумент подсети
subnet=$1

# Файл для записи результатов
output_file="responsive_hosts.txt"

# Очищаем файл перед началом
> "$output_file"

echo "Проверяем узлы в подсети ${subnet}0/24..."

# Пинг всех узлов в диапазоне 1-254
for i in {1..254}; do
    ip="${subnet}${i}"
    # Пинг узла с таймаутом 1 секунда и проверкой 1 пакета
    if ping -c 1 -W 1 "$ip" &> /dev/null; then
        echo "$ip доступен."
        echo "$ip" >> "$output_file"
    else
        echo "$ip недоступен."
    fi
done

echo "Проверка завершена. Список доступных узлов сохранен в $output_file."
